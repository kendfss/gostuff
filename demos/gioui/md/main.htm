<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="#ffffff" name="theme-color"/>
<title>~whereswaldon/gio-x: markdown/markdown.go - sourcehut git</title>
<link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QIGCC8n92KyhQAAAj1QTFRFAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////anIwUQAAAL50Uk5TAAECAwQFBgcICQoLDA4PEBESExQVFhcYGRobHB0eHyAhIyQmJygpKistLzAzNDU2Nzg5Ozw9QEFDREZHSElLTE1OT1BRVFdYWVpbXF1eX2BhZGZnaGltbnBxdHV3eHp7fn+AgYKDhIWGh4iJio2TlJucnqGio6Smp6ipqqusrbCxsrO0tre4ury9vr/Cw8TFxsfIycrMzc7P0dLT1dbY2dvf4OLj5OXm5+jq6+zt7u/w8fL09fb3+Pn6+/z9/gNzyOkAAAABYktHRL6k3IPDAAAFwUlEQVQYGe3B+VtUVQAG4G9i0TQZZyA1S0JxydzDNFTUqXBfcylzS8UE21TMyjAQUQnFEi0BHQU3cAc0UGbm+9v65Zw7y70zc++dc3qenof3xZAhQ4b8T+V/uGn/kdrm1psdHTdbm2uP7Ns434//yLD5e+u7aOH+6T0ludBszGf1L5jC87rNBdDm9XXnw0wrfG71cOhQ9N0z2vTk20Ko9t5PYToQOj4FKr17IkKHwtUToMobVQN0of/rkVDik7t06c5yZC7/V1rqajq6f9vKQFlZYNW2A0cvdNPSL35kaPEDmgxerFiSjwQFZQebQzTpKkUmsg4xUX/Nijwk4V15aoAJIhVZcM13ngnatuQhJe/WNiY464VLE28xXsMCD9LyLDzLeMEiuDLzIeM0zIRNs88xTvcMuFDSx1htC+FA6XXG6pkLx0qeM8aLHdlwJGfnP4zRNw8OzexjjOaJcGzSn4zR8z4cmfiQUZF9WXAhuyLCqO4iOOC7xahni+BSWQ+jgl7YlnWeUR3FcG1qJ6MasmDXIUZdexMZGNvGqAOwaTGjrnqREd/fNERKYUvBAxqueZEhXzsNXX7Y8SsNHW8iY+M6afgZNnxKw7NiKDCtl4YA0nrjHqXIIiixjIY7I5FOFQ37oEglDZVIo+glpeYsKJJ9mdJAIVI7QenFRChT3E+pGim9F6G0AwrtohSeglR+otSWDYVygpSqkUJRmNJCKLWEUmgCkvuOUgPU8vxO6TCSev0ZpZlQ7ANKj4YhmXWUGqBcI6UVSOY8pQVQbhGlM0hiTJhCmwfKeW5QCPlh7TNKW6DBdkobYa2eQn8eNPC9pPAbLA17QaEGWtRS6MuBlfmUVkCLtZTmwspeCoN50MIXprATVuopXIQmLRROwUoXhQpoUkXhNizkU1oCTZZRyoPZh5Tyock4SnNgtolCF3TxPKKwBmb7KTRBm0sUdsPsCIWj0OY4hR9gVkthP7SppHASZs0UtkGbLyg0wqyVwkpos4FCC8xuUghAm3IK7TDroFAGbQIUgjDroFAGbQIUgjC7SSEAbcoptMOslcIqaLOBQgvMmilsgzY7KDTCrJbCAWhTReEkzI5QOAptfqTwPcz2UbgAbS5R2AWzjRS6oYvnMYXVMJtPqQCavEVpNsz8lMqgyXJKo2DhPoWD0OQwhU5YOU2hGZpcoVADK3sohLzQwh+h8CWslFBaCS3WUZoDK7nPKZyCFnUUerNh6TSFAS808L+iUANrmylthQafU1oPawVhCm0eKOcJUhgcjSTOUVoI5RZTqkMyqymdhXJNlMqRzPAnlGZDsRJKD3OR1LeUzkEtTxOlSiRXGKL0EZRaSmlwPFI4Tul6DhTKvUXpGFKZEqa0EwrtoRQqRkrVlP6ZBGUmD1A6htQm9FP6IxuK5Fyl1P8O0viahgoo8g0NB5HOyDuUImVQ4mMabo9AWgEaeqZCgel9NCyFDb/Q0DkWGXv7Lg0nYIe/i4Y2HzKUf4OGe6NhS2mEhr98yEh+Kw3hBbCpglHt45CB8TcY9RXsyjrLqM5pcG36XUadfg22eYOM6l0Glz7uY9T1UXCg6AFjHMqGCznfMMb9Qjgyo4cxLhfDsclXGePpdDg0r48x+nflwJHcPQOM0TsLjs3rYazgEtjnWXqLsZ7Oggszuhnn9w9gU0kT49yfDleKgozXuMiDtDyLmxjveiFc8jYwwY3tPqTk/zzIBPWj4FpWRYQJXtau9SEJ/7q6V0wQ/uo1ZKK0iybhlqplYxHP89byw1ciNLm3ABny/0xLjy4dr/xiQ3kgUL5hR9WPlx7T0onRyFzgDl26vRRKjKwcoAv9B0dAlcLqMB0KH3sHKk2pDtGBwWPFUG3C4Ue06WHleOgwbMWZENMarCvPhTb+jb/1MYXemvWjoVnO3J2nbtNCZ82Xc7LxH8mbs2b3DycbW9qDwfaWxpPf71o9exSGDBky5P/pX9F6dsCMuJp+AAAAAElFTkSuQmCC" rel="icon" type="image/png"/>
<link href="/static/main.min.67840f78.css" rel="stylesheet"/>
<style>
pre {
  tab-size: 8
}
pre, body {
  padding-bottom: 0;
  margin-bottom: 0;
}
</style>
</head>
<body>
<nav class="navbar navbar-light navbar-expand-sm">
<span class="navbar-brand">
<span class="icon icon-circle"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200z"></path></svg>
</span>
<a href="https://sr.ht">
    sourcehut
  </a>
</span>
<ul class="navbar-nav">
</ul>
<div class="login">
<span class="navbar-text">
<a href="https://meta.sr.ht/oauth/authorize?client_id=25ff6e5ce60d7345&amp;scopes=profile,keys,b99a95de3e69c958/jobs:write&amp;state=%2F~whereswaldon%2Fgio-x%2Ftree%2Fmarkdown%2Fitem%2Fmarkdown%2Fmarkdown.go%3F" rel="nofollow">Log in</a>
    —
    <a href="https://meta.sr.ht">Register</a>
</span>
</div>
</nav>
<div class="header-tabbed">
<div class="container-fluid">
<h2>
<a href="/~whereswaldon/">~whereswaldon</a>/<wbr/>gio-x
      
    </h2>
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x">summary</a>
</li>
<li class="nav-item">
<a class="nav-link active" href="/~whereswaldon/gio-x/tree">tree</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x/log">log</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x/refs">refs</a>
</li>
</ul>
</div>
</div>
<div class="header-extension" style="margin-bottom: 0;">
<div class="blob container-fluid">
<span>
<span style="margin-right: 1rem">
<span class="text-muted">ref:</span> markdown
</span>
<a href="/~whereswaldon/gio-x/tree/markdown">gio-x</a>/<a href="/~whereswaldon/gio-x/tree/markdown/item/markdown">markdown</a>/markdown.go



  
  
  <span class="text-muted" style="margin-left: 1rem">
<span title="100644">
      -rw-r--r--
    </span>
</span>
<span class="text-muted" style="margin-left: 1rem">
<span title="9696 bytes">
        9.5 KiB
      </span>
</span>
<div class="blob-nav" style="margin-left: 1rem">
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" href="/~whereswaldon/gio-x/tree/markdown/item/markdown/markdown.go">View</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x/log/markdown/item/markdown/markdown.go">Log</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x/blame/markdown/markdown/markdown.go">Blame</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~whereswaldon/gio-x/blob/markdown/markdown/markdown.go">View raw</a>
</li>
</ul>
</div>
</span>
<div class="commit">
<a href="/~whereswaldon/gio-x/commit/markdown">6c948736</a> —
      
      
      <a href="/~whereswaldon/">Chris Waldon</a>
      
      richtext: prevent example import cycle
      <span class="text-muted">
<span title="2021-06-12 22:44:44 UTC">6 days ago</span>
</span>
</div>
<div class="clearfix"></div>
</div>
</div>
<div class="container-fluid code-viewport">
<div class="row" style="margin-right: 0;">
<div class="col-md-12 code-view">
<pre class="ruler"><span>                                                                                </span></pre>
<pre class="lines"><a href="#L1" id="L1">1</a>
<a href="#L2" id="L2">2</a>
<a href="#L3" id="L3">3</a>
<a href="#L4" id="L4">4</a>
<a href="#L5" id="L5">5</a>
<a href="#L6" id="L6">6</a>
<a href="#L7" id="L7">7</a>
<a href="#L8" id="L8">8</a>
<a href="#L9" id="L9">9</a>
<a href="#L10" id="L10">10</a>
<a href="#L11" id="L11">11</a>
<a href="#L12" id="L12">12</a>
<a href="#L13" id="L13">13</a>
<a href="#L14" id="L14">14</a>
<a href="#L15" id="L15">15</a>
<a href="#L16" id="L16">16</a>
<a href="#L17" id="L17">17</a>
<a href="#L18" id="L18">18</a>
<a href="#L19" id="L19">19</a>
<a href="#L20" id="L20">20</a>
<a href="#L21" id="L21">21</a>
<a href="#L22" id="L22">22</a>
<a href="#L23" id="L23">23</a>
<a href="#L24" id="L24">24</a>
<a href="#L25" id="L25">25</a>
<a href="#L26" id="L26">26</a>
<a href="#L27" id="L27">27</a>
<a href="#L28" id="L28">28</a>
<a href="#L29" id="L29">29</a>
<a href="#L30" id="L30">30</a>
<a href="#L31" id="L31">31</a>
<a href="#L32" id="L32">32</a>
<a href="#L33" id="L33">33</a>
<a href="#L34" id="L34">34</a>
<a href="#L35" id="L35">35</a>
<a href="#L36" id="L36">36</a>
<a href="#L37" id="L37">37</a>
<a href="#L38" id="L38">38</a>
<a href="#L39" id="L39">39</a>
<a href="#L40" id="L40">40</a>
<a href="#L41" id="L41">41</a>
<a href="#L42" id="L42">42</a>
<a href="#L43" id="L43">43</a>
<a href="#L44" id="L44">44</a>
<a href="#L45" id="L45">45</a>
<a href="#L46" id="L46">46</a>
<a href="#L47" id="L47">47</a>
<a href="#L48" id="L48">48</a>
<a href="#L49" id="L49">49</a>
<a href="#L50" id="L50">50</a>
<a href="#L51" id="L51">51</a>
<a href="#L52" id="L52">52</a>
<a href="#L53" id="L53">53</a>
<a href="#L54" id="L54">54</a>
<a href="#L55" id="L55">55</a>
<a href="#L56" id="L56">56</a>
<a href="#L57" id="L57">57</a>
<a href="#L58" id="L58">58</a>
<a href="#L59" id="L59">59</a>
<a href="#L60" id="L60">60</a>
<a href="#L61" id="L61">61</a>
<a href="#L62" id="L62">62</a>
<a href="#L63" id="L63">63</a>
<a href="#L64" id="L64">64</a>
<a href="#L65" id="L65">65</a>
<a href="#L66" id="L66">66</a>
<a href="#L67" id="L67">67</a>
<a href="#L68" id="L68">68</a>
<a href="#L69" id="L69">69</a>
<a href="#L70" id="L70">70</a>
<a href="#L71" id="L71">71</a>
<a href="#L72" id="L72">72</a>
<a href="#L73" id="L73">73</a>
<a href="#L74" id="L74">74</a>
<a href="#L75" id="L75">75</a>
<a href="#L76" id="L76">76</a>
<a href="#L77" id="L77">77</a>
<a href="#L78" id="L78">78</a>
<a href="#L79" id="L79">79</a>
<a href="#L80" id="L80">80</a>
<a href="#L81" id="L81">81</a>
<a href="#L82" id="L82">82</a>
<a href="#L83" id="L83">83</a>
<a href="#L84" id="L84">84</a>
<a href="#L85" id="L85">85</a>
<a href="#L86" id="L86">86</a>
<a href="#L87" id="L87">87</a>
<a href="#L88" id="L88">88</a>
<a href="#L89" id="L89">89</a>
<a href="#L90" id="L90">90</a>
<a href="#L91" id="L91">91</a>
<a href="#L92" id="L92">92</a>
<a href="#L93" id="L93">93</a>
<a href="#L94" id="L94">94</a>
<a href="#L95" id="L95">95</a>
<a href="#L96" id="L96">96</a>
<a href="#L97" id="L97">97</a>
<a href="#L98" id="L98">98</a>
<a href="#L99" id="L99">99</a>
<a href="#L100" id="L100">100</a>
<a href="#L101" id="L101">101</a>
<a href="#L102" id="L102">102</a>
<a href="#L103" id="L103">103</a>
<a href="#L104" id="L104">104</a>
<a href="#L105" id="L105">105</a>
<a href="#L106" id="L106">106</a>
<a href="#L107" id="L107">107</a>
<a href="#L108" id="L108">108</a>
<a href="#L109" id="L109">109</a>
<a href="#L110" id="L110">110</a>
<a href="#L111" id="L111">111</a>
<a href="#L112" id="L112">112</a>
<a href="#L113" id="L113">113</a>
<a href="#L114" id="L114">114</a>
<a href="#L115" id="L115">115</a>
<a href="#L116" id="L116">116</a>
<a href="#L117" id="L117">117</a>
<a href="#L118" id="L118">118</a>
<a href="#L119" id="L119">119</a>
<a href="#L120" id="L120">120</a>
<a href="#L121" id="L121">121</a>
<a href="#L122" id="L122">122</a>
<a href="#L123" id="L123">123</a>
<a href="#L124" id="L124">124</a>
<a href="#L125" id="L125">125</a>
<a href="#L126" id="L126">126</a>
<a href="#L127" id="L127">127</a>
<a href="#L128" id="L128">128</a>
<a href="#L129" id="L129">129</a>
<a href="#L130" id="L130">130</a>
<a href="#L131" id="L131">131</a>
<a href="#L132" id="L132">132</a>
<a href="#L133" id="L133">133</a>
<a href="#L134" id="L134">134</a>
<a href="#L135" id="L135">135</a>
<a href="#L136" id="L136">136</a>
<a href="#L137" id="L137">137</a>
<a href="#L138" id="L138">138</a>
<a href="#L139" id="L139">139</a>
<a href="#L140" id="L140">140</a>
<a href="#L141" id="L141">141</a>
<a href="#L142" id="L142">142</a>
<a href="#L143" id="L143">143</a>
<a href="#L144" id="L144">144</a>
<a href="#L145" id="L145">145</a>
<a href="#L146" id="L146">146</a>
<a href="#L147" id="L147">147</a>
<a href="#L148" id="L148">148</a>
<a href="#L149" id="L149">149</a>
<a href="#L150" id="L150">150</a>
<a href="#L151" id="L151">151</a>
<a href="#L152" id="L152">152</a>
<a href="#L153" id="L153">153</a>
<a href="#L154" id="L154">154</a>
<a href="#L155" id="L155">155</a>
<a href="#L156" id="L156">156</a>
<a href="#L157" id="L157">157</a>
<a href="#L158" id="L158">158</a>
<a href="#L159" id="L159">159</a>
<a href="#L160" id="L160">160</a>
<a href="#L161" id="L161">161</a>
<a href="#L162" id="L162">162</a>
<a href="#L163" id="L163">163</a>
<a href="#L164" id="L164">164</a>
<a href="#L165" id="L165">165</a>
<a href="#L166" id="L166">166</a>
<a href="#L167" id="L167">167</a>
<a href="#L168" id="L168">168</a>
<a href="#L169" id="L169">169</a>
<a href="#L170" id="L170">170</a>
<a href="#L171" id="L171">171</a>
<a href="#L172" id="L172">172</a>
<a href="#L173" id="L173">173</a>
<a href="#L174" id="L174">174</a>
<a href="#L175" id="L175">175</a>
<a href="#L176" id="L176">176</a>
<a href="#L177" id="L177">177</a>
<a href="#L178" id="L178">178</a>
<a href="#L179" id="L179">179</a>
<a href="#L180" id="L180">180</a>
<a href="#L181" id="L181">181</a>
<a href="#L182" id="L182">182</a>
<a href="#L183" id="L183">183</a>
<a href="#L184" id="L184">184</a>
<a href="#L185" id="L185">185</a>
<a href="#L186" id="L186">186</a>
<a href="#L187" id="L187">187</a>
<a href="#L188" id="L188">188</a>
<a href="#L189" id="L189">189</a>
<a href="#L190" id="L190">190</a>
<a href="#L191" id="L191">191</a>
<a href="#L192" id="L192">192</a>
<a href="#L193" id="L193">193</a>
<a href="#L194" id="L194">194</a>
<a href="#L195" id="L195">195</a>
<a href="#L196" id="L196">196</a>
<a href="#L197" id="L197">197</a>
<a href="#L198" id="L198">198</a>
<a href="#L199" id="L199">199</a>
<a href="#L200" id="L200">200</a>
<a href="#L201" id="L201">201</a>
<a href="#L202" id="L202">202</a>
<a href="#L203" id="L203">203</a>
<a href="#L204" id="L204">204</a>
<a href="#L205" id="L205">205</a>
<a href="#L206" id="L206">206</a>
<a href="#L207" id="L207">207</a>
<a href="#L208" id="L208">208</a>
<a href="#L209" id="L209">209</a>
<a href="#L210" id="L210">210</a>
<a href="#L211" id="L211">211</a>
<a href="#L212" id="L212">212</a>
<a href="#L213" id="L213">213</a>
<a href="#L214" id="L214">214</a>
<a href="#L215" id="L215">215</a>
<a href="#L216" id="L216">216</a>
<a href="#L217" id="L217">217</a>
<a href="#L218" id="L218">218</a>
<a href="#L219" id="L219">219</a>
<a href="#L220" id="L220">220</a>
<a href="#L221" id="L221">221</a>
<a href="#L222" id="L222">222</a>
<a href="#L223" id="L223">223</a>
<a href="#L224" id="L224">224</a>
<a href="#L225" id="L225">225</a>
<a href="#L226" id="L226">226</a>
<a href="#L227" id="L227">227</a>
<a href="#L228" id="L228">228</a>
<a href="#L229" id="L229">229</a>
<a href="#L230" id="L230">230</a>
<a href="#L231" id="L231">231</a>
<a href="#L232" id="L232">232</a>
<a href="#L233" id="L233">233</a>
<a href="#L234" id="L234">234</a>
<a href="#L235" id="L235">235</a>
<a href="#L236" id="L236">236</a>
<a href="#L237" id="L237">237</a>
<a href="#L238" id="L238">238</a>
<a href="#L239" id="L239">239</a>
<a href="#L240" id="L240">240</a>
<a href="#L241" id="L241">241</a>
<a href="#L242" id="L242">242</a>
<a href="#L243" id="L243">243</a>
<a href="#L244" id="L244">244</a>
<a href="#L245" id="L245">245</a>
<a href="#L246" id="L246">246</a>
<a href="#L247" id="L247">247</a>
<a href="#L248" id="L248">248</a>
<a href="#L249" id="L249">249</a>
<a href="#L250" id="L250">250</a>
<a href="#L251" id="L251">251</a>
<a href="#L252" id="L252">252</a>
<a href="#L253" id="L253">253</a>
<a href="#L254" id="L254">254</a>
<a href="#L255" id="L255">255</a>
<a href="#L256" id="L256">256</a>
<a href="#L257" id="L257">257</a>
<a href="#L258" id="L258">258</a>
<a href="#L259" id="L259">259</a>
<a href="#L260" id="L260">260</a>
<a href="#L261" id="L261">261</a>
<a href="#L262" id="L262">262</a>
<a href="#L263" id="L263">263</a>
<a href="#L264" id="L264">264</a>
<a href="#L265" id="L265">265</a>
<a href="#L266" id="L266">266</a>
<a href="#L267" id="L267">267</a>
<a href="#L268" id="L268">268</a>
<a href="#L269" id="L269">269</a>
<a href="#L270" id="L270">270</a>
<a href="#L271" id="L271">271</a>
<a href="#L272" id="L272">272</a>
<a href="#L273" id="L273">273</a>
<a href="#L274" id="L274">274</a>
<a href="#L275" id="L275">275</a>
<a href="#L276" id="L276">276</a>
<a href="#L277" id="L277">277</a>
<a href="#L278" id="L278">278</a>
<a href="#L279" id="L279">279</a>
<a href="#L280" id="L280">280</a>
<a href="#L281" id="L281">281</a>
<a href="#L282" id="L282">282</a>
<a href="#L283" id="L283">283</a>
<a href="#L284" id="L284">284</a>
<a href="#L285" id="L285">285</a>
<a href="#L286" id="L286">286</a>
<a href="#L287" id="L287">287</a>
<a href="#L288" id="L288">288</a>
<a href="#L289" id="L289">289</a>
<a href="#L290" id="L290">290</a>
<a href="#L291" id="L291">291</a>
<a href="#L292" id="L292">292</a>
<a href="#L293" id="L293">293</a>
<a href="#L294" id="L294">294</a>
<a href="#L295" id="L295">295</a>
<a href="#L296" id="L296">296</a>
<a href="#L297" id="L297">297</a>
<a href="#L298" id="L298">298</a>
<a href="#L299" id="L299">299</a>
<a href="#L300" id="L300">300</a>
<a href="#L301" id="L301">301</a>
<a href="#L302" id="L302">302</a>
<a href="#L303" id="L303">303</a>
<a href="#L304" id="L304">304</a>
<a href="#L305" id="L305">305</a>
<a href="#L306" id="L306">306</a>
<a href="#L307" id="L307">307</a>
<a href="#L308" id="L308">308</a>
<a href="#L309" id="L309">309</a>
<a href="#L310" id="L310">310</a>
<a href="#L311" id="L311">311</a>
<a href="#L312" id="L312">312</a>
<a href="#L313" id="L313">313</a>
<a href="#L314" id="L314">314</a>
<a href="#L315" id="L315">315</a>
<a href="#L316" id="L316">316</a>
<a href="#L317" id="L317">317</a>
<a href="#L318" id="L318">318</a>
<a href="#L319" id="L319">319</a>
<a href="#L320" id="L320">320</a>
<a href="#L321" id="L321">321</a>
<a href="#L322" id="L322">322</a>
<a href="#L323" id="L323">323</a>
<a href="#L324" id="L324">324</a>
<a href="#L325" id="L325">325</a>
<a href="#L326" id="L326">326</a>
<a href="#L327" id="L327">327</a>
<a href="#L328" id="L328">328</a>
<a href="#L329" id="L329">329</a>
<a href="#L330" id="L330">330</a>
<a href="#L331" id="L331">331</a>
<a href="#L332" id="L332">332</a>
<a href="#L333" id="L333">333</a>
<a href="#L334" id="L334">334</a>
<a href="#L335" id="L335">335</a>
<a href="#L336" id="L336">336</a>
<a href="#L337" id="L337">337</a></pre>
<div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: Unlicense OR MIT</span>

<span class="cm">/*</span>
<span class="cm">Package markdown transforms markdown text into gio richtext.</span>
<span class="cm">*/</span>
<span class="kn">package</span> <span class="nx">markdown</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">"bytes"</span>
	<span class="s">"fmt"</span>
	<span class="s">"io/ioutil"</span>
	<span class="s">"regexp"</span>
	<span class="s">"strings"</span>

	<span class="s">"gioui.org/text"</span>
	<span class="s">"gioui.org/widget/material"</span>
	<span class="s">"gioui.org/x/richtext"</span>

	<span class="s">"github.com/yuin/goldmark"</span>
	<span class="s">"github.com/yuin/goldmark/ast"</span>
	<span class="s">"github.com/yuin/goldmark/renderer"</span>
	<span class="s">"github.com/yuin/goldmark/util"</span>
<span class="p">)</span>

<span class="c1">// gioNodeRenderer transforms AST nodes into gio's richtext types</span>
<span class="kd">type</span> <span class="nx">gioNodeRenderer</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">TextObjects</span> <span class="p">[]</span><span class="nx">richtext</span><span class="p">.</span><span class="nx">SpanStyle</span>

	<span class="nx">Current</span>      <span class="nx">richtext</span><span class="p">.</span><span class="nx">SpanStyle</span>
	<span class="nx">Theme</span>        <span class="o">*</span><span class="nx">material</span><span class="p">.</span><span class="nx">Theme</span>
	<span class="nx">OrderedList</span>  <span class="kt">bool</span>
	<span class="nx">OrderedIndex</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">newNodeRenderer</span><span class="p">()</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">gioNodeRenderer</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">CommitCurrent</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">DeepCopy</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">UpdateCurrent</span><span class="p">(</span><span class="nx">l</span> <span class="nx">material</span><span class="p">.</span><span class="nx">LabelStyle</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">Font</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">Color</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Size</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">TextSize</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">AppendNewline</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">Content</span> <span class="o">+=</span> <span class="s">"\n"</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">last</span> <span class="o">:=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">last</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span> <span class="s">"\n\n"</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">last</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span> <span class="s">"\n"</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="s">"\n"</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="s">"\n\n"</span>
		<span class="p">}</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">RegisterFuncs</span><span class="p">(</span><span class="nx">reg</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">NodeRendererFuncRegisterer</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// blocks</span>
	<span class="c1">//</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindDocument</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderDocument</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindHeading</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderHeading</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindBlockquote</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderBlockquote</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindCodeBlock</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderCodeBlock</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindFencedCodeBlock</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderFencedCodeBlock</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindHTMLBlock</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderHTMLBlock</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindList</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderList</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindListItem</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderListItem</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindParagraph</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderParagraph</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindTextBlock</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderTextBlock</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindThematicBreak</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderThematicBreak</span><span class="p">)</span>
	<span class="c1">//</span>
	<span class="c1">//	// inlines</span>
	<span class="c1">//</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindAutoLink</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderAutoLink</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindCodeSpan</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderCodeSpan</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindEmphasis</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderEmphasis</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindImage</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderImage</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindLink</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderLink</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindRawHTML</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderRawHTML</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindText</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderText</span><span class="p">)</span>
	<span class="nx">reg</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">KindString</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">renderString</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderDocument</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderHeading</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Heading</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
		<span class="kd">var</span> <span class="nx">l</span> <span class="nx">material</span><span class="p">.</span><span class="nx">LabelStyle</span>
		<span class="k">switch</span> <span class="nx">n</span><span class="p">.</span><span class="nx">Level</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H1</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H2</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H3</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H4</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H5</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
			<span class="nx">l</span> <span class="p">=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">H6</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">UpdateCurrent</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">l</span> <span class="o">:=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">Body1</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">UpdateCurrent</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderBlockquote</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderCodeBlock</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">"Mono"</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">""</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderFencedCodeBlock</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">FencedCodeBlock</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">"Mono"</span>
		<span class="nx">lines</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">Lines</span><span class="p">()</span>
		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">Len</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
			<span class="nx">line</span> <span class="o">:=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">At</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">Value</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">""</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderHTMLBlock</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">"Mono"</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">""</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderList</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">List</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">OrderedList</span> <span class="p">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">IsOrdered</span><span class="p">()</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">OrderedIndex</span> <span class="p">=</span> <span class="mi">1</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderListItem</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">g</span><span class="p">.</span><span class="nx">OrderedList</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">" %d. "</span><span class="p">,</span> <span class="nx">g</span><span class="p">.</span><span class="nx">OrderedIndex</span><span class="p">)</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">OrderedIndex</span><span class="o">++</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="s">" • "</span>
		<span class="p">}</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">AppendNewline</span><span class="p">()</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderParagraph</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">EnsureSeparationFromPrevious</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderTextBlock</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderThematicBreak</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderAutoLink</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">AutoLink</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">url</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">URL</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">MetadataURL</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">.</span><span class="nx">ContrastBg</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="nx">url</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">MetadataURL</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">.</span><span class="nx">Fg</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderCodeSpan</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">"Mono"</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Variant</span> <span class="p">=</span> <span class="s">""</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderEmphasis</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Emphasis</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">Level</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Weight</span> <span class="p">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">Bold</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Style</span> <span class="p">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">Italic</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Style</span> <span class="p">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">Regular</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">Weight</span> <span class="p">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">Normal</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderImage</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">MetadataURL</span> <span class="p">=</span> <span class="s">"url"</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderLink</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Link</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">.</span><span class="nx">ContrastBg</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Interactive</span> <span class="p">=</span> <span class="kc">true</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">MetadataURL</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">Destination</span><span class="p">))</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Theme</span><span class="p">.</span><span class="nx">Fg</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Interactive</span> <span class="p">=</span> <span class="kc">false</span>
		<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">MetadataURL</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderRawHTML</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderText</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">entering</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Text</span><span class="p">)</span>
	<span class="nx">segment</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">Segment</span>
	<span class="nx">content</span> <span class="o">:=</span> <span class="nx">segment</span><span class="p">.</span><span class="nx">Value</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>

	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">renderString</span><span class="p">(</span><span class="nx">w</span> <span class="nx">util</span><span class="p">.</span><span class="nx">BufWriter</span><span class="p">,</span> <span class="nx">source</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">entering</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">Current</span><span class="p">.</span><span class="nx">Content</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">CommitCurrent</span><span class="p">()</span>
	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkContinue</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span><span class="p">)</span> <span class="nx">Result</span><span class="p">()</span> <span class="p">[]</span><span class="nx">richtext</span><span class="p">.</span><span class="nx">SpanStyle</span> <span class="p">{</span>
	<span class="nx">o</span> <span class="o">:=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span>
	<span class="nx">g</span><span class="p">.</span><span class="nx">TextObjects</span> <span class="p">=</span> <span class="kc">nil</span>
	<span class="k">return</span> <span class="nx">o</span>
<span class="p">}</span>

<span class="c1">// Renderer can transform source markdown into Gio richtext.</span>
<span class="kd">type</span> <span class="nx">Renderer</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">md</span> <span class="nx">goldmark</span><span class="p">.</span><span class="nx">Markdown</span>
	<span class="nx">nr</span> <span class="o">*</span><span class="nx">gioNodeRenderer</span>
<span class="p">}</span>

<span class="c1">// NewRenderer creates a ready-to-use markdown renderer.</span>
<span class="kd">func</span> <span class="nx">NewRenderer</span><span class="p">()</span> <span class="o">*</span><span class="nx">Renderer</span> <span class="p">{</span>
	<span class="nx">nr</span> <span class="o">:=</span> <span class="nx">newNodeRenderer</span><span class="p">()</span>
	<span class="nx">md</span> <span class="o">:=</span> <span class="nx">goldmark</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
		<span class="nx">goldmark</span><span class="p">.</span><span class="nx">WithRenderer</span><span class="p">(</span>
			<span class="nx">renderer</span><span class="p">.</span><span class="nx">NewRenderer</span><span class="p">(</span>
				<span class="nx">renderer</span><span class="p">.</span><span class="nx">WithNodeRenderers</span><span class="p">(</span>
					<span class="nx">util</span><span class="p">.</span><span class="nx">PrioritizedValue</span><span class="p">{</span><span class="nx">Value</span><span class="p">:</span> <span class="nx">nr</span><span class="p">,</span> <span class="nx">Priority</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
				<span class="p">),</span>
			<span class="p">),</span>
		<span class="p">),</span>
	<span class="p">)</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Renderer</span><span class="p">{</span><span class="nx">md</span><span class="p">:</span> <span class="nx">md</span><span class="p">,</span> <span class="nx">nr</span><span class="p">:</span> <span class="nx">nr</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">NonParenBracketAndSpace</span> <span class="p">=</span> <span class="s">`[^([\s]`</span>

<span class="c1">// this regex matches a :// with one or more character that isn't whitespace</span>
<span class="c1">// a square bracket, or a parentheses on either side. It seems to reliably</span>
<span class="c1">// detect content that should be hyperlinked without actually matching</span>
<span class="c1">// markdown link syntax.</span>
<span class="kd">var</span> <span class="nx">urlExp</span> <span class="p">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`(^|\s)([^([\s]+://[^)\]\s]+)`</span><span class="p">)</span>

<span class="c1">// Render transforms the provided src markdown into gio richtext using the</span>
<span class="c1">// fonts and styles defined by the given theme.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Renderer</span><span class="p">)</span> <span class="nx">Render</span><span class="p">(</span><span class="nx">th</span> <span class="o">*</span><span class="nx">material</span><span class="p">.</span><span class="nx">Theme</span><span class="p">,</span> <span class="nx">src</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">([]</span><span class="nx">richtext</span><span class="p">.</span><span class="nx">SpanStyle</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"://"</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">src</span> <span class="p">=</span> <span class="nx">urlExp</span><span class="p">.</span><span class="nx">ReplaceAll</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"$1[$2]($2)"</span><span class="p">))</span>
	<span class="p">}</span>
	<span class="nx">l</span> <span class="o">:=</span> <span class="nx">material</span><span class="p">.</span><span class="nx">Body1</span><span class="p">(</span><span class="nx">th</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">nr</span><span class="p">.</span><span class="nx">Theme</span> <span class="p">=</span> <span class="nx">th</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">nr</span><span class="p">.</span><span class="nx">UpdateCurrent</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">Convert</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">Discard</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">nr</span><span class="p">.</span><span class="nx">Result</span><span class="p">(),</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<script src="/static/linelight.js"></script>
<!-- https://bugs.chromium.org/p/chromium/issues/detail?id=332189 -->
<script> </script>
</div></body>
</html>